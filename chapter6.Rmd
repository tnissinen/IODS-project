# Chapter 6: Analysis of longitudinal data

### Loading and checking the structure of the data

```{r readdata_rats,echo=TRUE,results='hide',message=FALSE,warning=FALSE}

# access libraries
library(dplyr)
library(tidyr)
library(ggplot2)

```

```{r}
# load the RATS data
BPRSL <- read.csv("~/IODS-project/data/bprs_long.csv")

# explore the dataset
str(BPRSL)
summary(BPRSL)

BPRSL$treatment <- factor(BPRSL$treatment)
BPRSL$subject <- factor(BPRSL$subject)

```

...

### Graphical Displays of Longitudinal Data

Individual response profiles by treatment group for the BPRS data.

```{r fig_rats, fig.path="figures/", fig.dim=c(5,3), results='hide', message=FALSE, warning=FALSE}

# Draw the plot
ggplot(BPRSL, aes(x = week, y = bprs, linetype = subject)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ treatment, labeller = label_both) +
  theme(legend.position = "none") + 
  scale_y_continuous(limits = c(min(BPRSL$bprs), max(BPRSL$bprs)))

```


Individual response profiles for BPRS data after standardization.

```{r fig_rats2, fig.path="figures/", fig.dim=c(5,3), results='hide', message=FALSE, warning=FALSE}

# Standardise the variable bprs
BPRSL <- BPRSL %>%
  group_by(week) %>%
  mutate(stdbprs = (bprs - mean(bprs))/sd(bprs)) %>%
  ungroup()

# Plot again with the standardised bprs
ggplot(BPRSL, aes(x = week, y = stdbprs, linetype = subject)) +
  geom_line() +
  scale_linetype_manual(values = rep(1:10, times=4)) +
  facet_grid(. ~ treatment, labeller = label_both) +
  scale_y_continuous(name = "standardized bprs")


```

...


### Summary Measure Analysis of Longitudinal Data


```{r}

# Number of weeks, baseline (week 0) included
n <- BPRSL$week %>% unique() %>% length()

# Summary data with mean and standard error of bprs by treatment and week 
BPRSS <- BPRSL %>%
  group_by(treatment, week) %>%
  summarise( mean = mean(bprs), se = sd(bprs)/sqrt(n) ) %>%
  ungroup()

# Glimpse the data
glimpse(BPRSS)


```


Mean response profiles for the two treatment groups in the BPRS data.

```{r fig_rats3, fig.path="figures/", fig.dim=c(5,3), results='hide', message=FALSE, warning=FALSE}

# Plot the mean profiles
ggplot(BPRSS, aes(x = week, y = mean, linetype = treatment, shape = treatment)) +
  geom_line() +
  scale_linetype_manual(values = c(1,2)) +
  geom_point(size=3) +
  scale_shape_manual(values = c(1,2)) +
  #geom_errorbar(aes(ymin=mean-se, ymax=mean+se, linetype="1"), width=0.3) +
  theme(legend.position = c(0.8,0.8)) +
  scale_y_continuous(name = "mean(bprs) +/- se(bprs)")

```
